<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Hello World</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        /* Fix AR.js camera scaling issues */
        #arjsDebugUIContainer {
            display: none !important;
        }

        a-scene {
            width: 100% !important;
            height: 100% !important;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        video {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
        }

        #instructions {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            text-align: center;
            font-size: 14px;
        }

        #switchMode {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #00ff88;
            color: black;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="instructions">
        ðŸ“± Point your camera around to find flat surfaces, then tap to place objects!
    </div>

    <button id="switchMode">Switch to Marker Mode</button>

    <!-- Marker-free AR Scene -->
    <a-scene
        id="markerFreeScene"
        embedded
        arjs="sourceType: webcam;
              sourceWidth: 1280; sourceHeight: 960;
              displayWidth: 1280; displayHeight: 960;
              debugUIEnabled: false;
              detectionMode: mono_and_matrix;
              matrixCodeType: 3x3;
              cameraParametersUrl: https://raw.githack.com/AR-js-org/AR.js/master/data/data/camera_para.dat;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
        gesture-detector
        cursor="rayOrigin: mouse"
    >
        <!-- Assets -->
        <a-assets>
            <a-mixin id="animation-mixer" animation-mixer></a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 1 1" color="#ffffff" intensity="0.8"></a-light>

        <!-- AR Camera -->
        <a-entity camera look-controls-enabled="false" arjs-look-controls="smoothingFactor: 0.1"></a-entity>
    </a-scene>

    <!-- Marker-based AR Scene -->
    <a-scene
        id="markerScene"
        class="hidden"
        embedded
        arjs="sourceType: webcam;
              sourceWidth: 1280; sourceHeight: 960;
              displayWidth: 1280; displayHeight: 960;
              debugUIEnabled: false;
              cameraParametersUrl: https://raw.githack.com/AR-js-org/AR.js/master/data/data/camera_para.dat;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
    >
        <!-- Hiro Marker -->
        <a-marker preset="hiro">
            <!-- Spinning colorful cube -->
            <a-box
                position="0 0.5 0"
                rotation="0 0 0"
                scale="0.5 0.5 0.5"
                material="color: #FF6B6B"
                animation="property: rotation; to: 360 360 360; loop: true; dur: 4000">
            </a-box>

            <!-- Floating ring -->
            <a-ring
                position="0 1.5 0"
                radius-inner="0.2"
                radius-outer="0.4"
                material="color: #4ECDC4; transparent: true; opacity: 0.8"
                animation="property: rotation; to: 0 0 360; loop: true; dur: 2000">
            </a-ring>

            <!-- Pulsing sphere -->
            <a-sphere
                position="1 0.5 0"
                radius="0.3"
                material="color: #45B7D1; transparent: true; opacity: 0.7"
                animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
            </a-sphere>

            <!-- Simple text -->
            <a-text
                value="Hello AR!"
                position="0 2 0"
                align="center"
                color="#FFE66D"
                scale="2 2 2">
            </a-text>
        </a-marker>

        <!-- AR Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let isMarkerMode = false;
        let placedObjects = 0;

        const instructions = document.getElementById('instructions');
        const switchBtn = document.getElementById('switchMode');
        const markerFreeScene = document.getElementById('markerFreeScene');
        const markerScene = document.getElementById('markerScene');

        // Object templates for marker-free mode
        const objects = [
            {
                type: 'box',
                color: '#FF6B6B',
                animation: 'property: rotation; to: 360 360 360; loop: true; dur: 3000'
            },
            {
                type: 'sphere',
                color: '#4ECDC4',
                animation: 'property: scale; to: 1.3 1.3 1.3; dir: alternate; loop: true; dur: 1500'
            },
            {
                type: 'cylinder',
                color: '#45B7D1',
                animation: 'property: rotation; to: 0 360 0; loop: true; dur: 2000'
            },
            {
                type: 'ring',
                color: '#FFE66D',
                animation: 'property: rotation; to: 360 0 360; loop: true; dur: 2500'
            }
        ];

        // Switch between modes
        switchBtn.addEventListener('click', () => {
            isMarkerMode = !isMarkerMode;

            if (isMarkerMode) {
                markerFreeScene.classList.add('hidden');
                markerScene.classList.remove('hidden');
                instructions.innerHTML = 'ðŸŽ¯ Point camera at this <a href="https://raw.githack.com/AR-js-org/AR.js/master/data/images/hiro.png" target="_blank" style="color:#00ff88;">HIRO marker</a> to see AR objects!';
                switchBtn.textContent = 'Switch to Marker-Free Mode';
            } else {
                markerScene.classList.add('hidden');
                markerFreeScene.classList.remove('hidden');
                instructions.innerHTML = 'ðŸ“± Point your camera around to find flat surfaces, then tap to place objects!';
                switchBtn.textContent = 'Switch to Marker Mode';
            }
        });

        // Add click/tap functionality for marker-free mode
        document.addEventListener('click', (e) => {
            if (isMarkerMode) return;

            // Simple object placement (this is a basic implementation)
            const scene = markerFreeScene;
            const camera = scene.querySelector('[camera]');

            if (scene && camera) {
                const objectData = objects[placedObjects % objects.length];
                const entity = document.createElement('a-entity');

                // Set geometry
                entity.setAttribute('geometry', {
                    primitive: objectData.type,
                    ...(objectData.type === 'ring' && {
                        radiusInner: 0.2,
                        radiusOuter: 0.4
                    })
                });

                entity.setAttribute('material', {
                    color: objectData.color,
                    transparent: true,
                    opacity: 0.8
                });

                // Position in front of camera
                const cameraEl = camera;
                const position = new THREE.Vector3(0, 0, -2);
                position.applyMatrix4(cameraEl.object3D.matrixWorld);

                entity.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
                entity.setAttribute('scale', '0.3 0.3 0.3');
                entity.setAttribute('animation', objectData.animation);

                scene.appendChild(entity);
                placedObjects++;

                // Update instructions
                instructions.innerHTML = `ðŸ“± Object ${placedObjects} placed! Tap anywhere to place more objects.`;

                // Clear instruction after 3 seconds
                setTimeout(() => {
                    if (!isMarkerMode) {
                        instructions.innerHTML = 'ðŸ“± Point your camera around and tap to place more objects!';
                    }
                }, 3000);
            }
        });

        // Hide instructions after 10 seconds
        setTimeout(() => {
            instructions.style.opacity = '0.5';
        }, 10000);

        // Fix camera aspect ratio on load
        window.addEventListener('load', () => {
            setTimeout(fixCameraAspect, 1000);
        });

        // Handle orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(fixCameraAspect, 500);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            setTimeout(fixCameraAspect, 200);
        });

        function fixCameraAspect() {
            const videos = document.querySelectorAll('video');
            const canvases = document.querySelectorAll('canvas');

            videos.forEach(video => {
                if (video) {
                    video.style.width = '100%';
                    video.style.height = '100%';
                    video.style.objectFit = 'cover';
                }
            });

            canvases.forEach(canvas => {
                if (canvas) {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                }
            });

            // Force scene resize
            const scenes = document.querySelectorAll('a-scene');
            scenes.forEach(scene => {
                if (scene.renderer) {
                    scene.renderer.setSize(window.innerWidth, window.innerHeight);
                }
            });
        }
    </script>
</body>
</html>