<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AR Diagnostic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .good { background: #2d5016; border-left: 4px solid #4caf50; }
        .bad { background: #4a1e1e; border-left: 4px solid #f44336; }
        .warning { background: #4a3a1e; border-left: 4px solid #ff9800; }
        .info { background: #1e3a4a; border-left: 4px solid #2196f3; }

        button {
            padding: 15px 30px;
            font-size: 16px;
            background: #00ff88;
            color: black;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            max-width: 300px;
        }
        button:hover { background: #00cc66; }
        button:disabled { background: #666; cursor: not-allowed; }

        #videoPreview {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: #333;
            border-radius: 8px;
            margin: 20px 0;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç AR Diagnostic Tool</h1>

    <div class="section">
        <h2>System Check</h2>
        <div id="systemStatus"></div>
    </div>

    <div class="section">
        <h2>Camera Test</h2>
        <button id="testCamera">Test Camera Access</button>
        <video id="videoPreview" autoplay muted playsinline style="display: none;"></video>
        <div id="cameraStatus"></div>
    </div>

    <div class="section">
        <h2>AR Support Check</h2>
        <button id="testAR">Test AR Support</button>
        <div id="arStatus"></div>
    </div>

    <div class="section">
        <h2>Solutions</h2>
        <div id="solutions"></div>
    </div>

    <script>
        const systemStatus = document.getElementById('systemStatus');
        const cameraStatus = document.getElementById('cameraStatus');
        const arStatus = document.getElementById('arStatus');
        const solutions = document.getElementById('solutions');
        const testCameraBtn = document.getElementById('testCamera');
        const testARBtn = document.getElementById('testAR');
        const videoPreview = document.getElementById('videoPreview');

        // System checks
        function checkSystem() {
            let html = '';

            // HTTPS Check
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                html += '<div class="status good">‚úÖ HTTPS: Secure connection detected</div>';
            } else {
                html += '<div class="status bad">‚ùå HTTPS: Not secure! AR requires HTTPS</div>';
            }

            // Browser check
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome') || userAgent.includes('Firefox') || userAgent.includes('Safari')) {
                html += '<div class="status good">‚úÖ Browser: Compatible browser detected</div>';
            } else {
                html += '<div class="status warning">‚ö†Ô∏è Browser: Unknown compatibility</div>';
            }

            // Mobile check
            if (/Mobi|Android/i.test(userAgent)) {
                html += '<div class="status info">üì± Device: Mobile device detected</div>';
            } else {
                html += '<div class="status info">üíª Device: Desktop detected</div>';
            }

            // WebRTC check
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                html += '<div class="status good">‚úÖ WebRTC: Camera API available</div>';
            } else {
                html += '<div class="status bad">‚ùå WebRTC: Camera API not available</div>';
            }

            systemStatus.innerHTML = html;
        }

        // Test camera access
        testCameraBtn.addEventListener('click', async () => {
            testCameraBtn.disabled = true;
            testCameraBtn.textContent = 'Testing...';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment' // Back camera
                    }
                });

                videoPreview.srcObject = stream;
                videoPreview.style.display = 'block';
                cameraStatus.innerHTML = '<div class="status good">‚úÖ Camera access granted! You should see video above.</div>';

                // Stop the stream after 5 seconds to save battery
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    videoPreview.style.display = 'none';
                    cameraStatus.innerHTML += '<div class="status info">‚ÑπÔ∏è Video stopped to save battery</div>';
                }, 5000);

            } catch (error) {
                let message = '';
                switch(error.name) {
                    case 'NotAllowedError':
                        message = '‚ùå Camera permission denied. Please allow camera access and try again.';
                        break;
                    case 'NotFoundError':
                        message = '‚ùå No camera found on this device.';
                        break;
                    case 'NotSupportedError':
                        message = '‚ùå Camera not supported in this browser.';
                        break;
                    default:
                        message = `‚ùå Camera error: ${error.message}`;
                }
                cameraStatus.innerHTML = `<div class="status bad">${message}</div>`;
            }

            testCameraBtn.disabled = false;
            testCameraBtn.textContent = 'Test Camera Access';
        });

        // Test AR support
        testARBtn.addEventListener('click', async () => {
            testARBtn.disabled = true;
            testARBtn.textContent = 'Testing...';

            let html = '';

            // WebXR check
            if ('xr' in navigator) {
                try {
                    const supported = await navigator.xr.isSessionSupported('immersive-ar');
                    if (supported) {
                        html += '<div class="status good">‚úÖ WebXR AR: Fully supported!</div>';
                    } else {
                        html += '<div class="status warning">‚ö†Ô∏è WebXR AR: Not supported on this device</div>';
                    }
                } catch (e) {
                    html += '<div class="status warning">‚ö†Ô∏è WebXR AR: Error checking support</div>';
                }
            } else {
                html += '<div class="status bad">‚ùå WebXR: Not available in this browser</div>';
            }

            // Device orientation check
            if ('DeviceOrientationEvent' in window) {
                html += '<div class="status good">‚úÖ Device Orientation: Available</div>';
            } else {
                html += '<div class="status warning">‚ö†Ô∏è Device Orientation: Not available</div>';
            }

            arStatus.innerHTML = html;
            testARBtn.disabled = false;
            testARBtn.textContent = 'Test AR Support';
        });

        // Generate solutions
        function generateSolutions() {
            let html = '<h3>Common Solutions:</h3>';

            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                html += `
                    <div class="status bad">
                        <strong>üîí HTTPS Required</strong><br>
                        AR apps need HTTPS. Try one of these:
                        <ul>
                            <li>Use GitHub Pages (free HTTPS hosting)</li>
                            <li>Use CodePen, JSFiddle, or similar</li>
                            <li>Use ngrok to tunnel localhost</li>
                            <li>Test on localhost (some browsers allow it)</li>
                        </ul>
                    </div>
                `;
            }

            html += `
                <div class="status info">
                    <strong>üì± For Mobile Users:</strong><br>
                    <ul>
                        <li>Make sure camera permission is granted</li>
                        <li>Try Chrome on Android or Safari on iOS</li>
                        <li>Close other apps that might use the camera</li>
                        <li>Restart your browser if needed</li>
                    </ul>
                </div>

                <div class="status info">
                    <strong>üåê Browser Recommendations:</strong><br>
                    <ul>
                        <li><strong>Android:</strong> Chrome (best AR support)</li>
                        <li><strong>iOS:</strong> Safari (WebXR support varies)</li>
                        <li><strong>Desktop:</strong> Chrome or Firefox</li>
                    </ul>
                </div>

                <div class="status warning">
                    <strong>üîß Still not working?</strong><br>
                    <ul>
                        <li>Check browser console for errors (F12)</li>
                        <li>Try in incognito/private mode</li>
                        <li>Disable ad blockers temporarily</li>
                        <li>Make sure your device has AR capabilities</li>
                    </ul>
                </div>
            `;

            solutions.innerHTML = html;
        }

        // Run initial checks
        checkSystem();
        generateSolutions();

        // Log additional info to console
        console.log('User Agent:', navigator.userAgent);
        console.log('Location:', location.href);
        console.log('Protocol:', location.protocol);
    </script>
</body>
</html>