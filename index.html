<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Camera Fix</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
        }

        #arjs-video {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            z-index: -1 !important;
            transform: none !important;
        }

        a-scene {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }

        #instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            text-align: center;
        }

        #placeButton {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4444;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="instructions">
        ðŸ“± Camera should be centered now. Tap the red button to place a cube!
    </div>

    <button id="placeButton">Place Cube</button>

    <a-scene
        embedded
        arjs="sourceType: webcam;
              sourceWidth: 640; sourceHeight: 480;
              displayWidth: 640; displayHeight: 480;
              debugUIEnabled: false;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
    >
        <!-- Simple lighting -->
        <a-light type="ambient" color="#fff" intensity="0.4"></a-light>
        <a-light type="directional" position="0 1 1" color="#fff" intensity="0.6"></a-light>

        <!-- Marker -->
        <a-marker preset="hiro">
            <a-box
                id="markerBox"
                position="0 0.5 0"
                scale="0.5 0.5 0.5"
                material="color: red"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 2000">
            </a-box>
        </a-marker>

        <!-- Camera -->
        <a-entity camera look-controls-enabled="false"></a-entity>
    </a-scene>

    <script>
        let cubeCount = 0;
        const instructions = document.getElementById('instructions');
        const placeButton = document.getElementById('placeButton');

        // Force fix video positioning after everything loads
        setTimeout(() => {
            fixVideoPosition();
        }, 1000);

        setTimeout(() => {
            fixVideoPosition();
        }, 3000);

        function fixVideoPosition() {
            console.log('Attempting to fix video position...');

            // Find the AR.js video element
            const videos = document.querySelectorAll('video');
            console.log('Found videos:', videos.length);

            videos.forEach((video, index) => {
                console.log(`Video ${index}:`, video);
                video.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    object-fit: cover !important;
                    z-index: -1 !important;
                    transform: none !important;
                    margin: 0 !important;
                    padding: 0 !important;
                `;
            });

            // Fix canvas positioning too
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach((canvas, index) => {
                console.log(`Canvas ${index}:`, canvas);
                canvas.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    z-index: 1 !important;
                `;
            });
        }

        // Button to place cubes in camera view
        placeButton.addEventListener('click', () => {
            const scene = document.querySelector('a-scene');
            const cube = document.createElement('a-box');

            cubeCount++;
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const color = colors[cubeCount % colors.length];

            cube.setAttribute('position', `${(Math.random()-0.5)*4} ${Math.random()*2+0.5} ${-2-Math.random()*2}`);
            cube.setAttribute('scale', '0.3 0.3 0.3');
            cube.setAttribute('material', `color: ${color}`);
            cube.setAttribute('animation', 'property: rotation; to: 360 360 360; loop: true; dur: 3000');

            scene.appendChild(cube);

            instructions.innerHTML = `ðŸ“± Cube ${cubeCount} placed! ${cubeCount < 3 ? 'Try placing more!' : 'Looking good!'}`;
        });

        // Multiple attempts to fix positioning
        window.addEventListener('load', () => {
            setTimeout(fixVideoPosition, 500);
            setTimeout(fixVideoPosition, 1500);
            setTimeout(fixVideoPosition, 3000);
        });

        // Watch for new video elements being added
        const observer = new MutationObserver(() => {
            setTimeout(fixVideoPosition, 100);
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Log what we find for debugging
        setTimeout(() => {
            console.log('=== DEBUG INFO ===');
            console.log('Videos found:', document.querySelectorAll('video').length);
            console.log('Canvases found:', document.querySelectorAll('canvas').length);
            console.log('Window size:', window.innerWidth, 'x', window.innerHeight);

            document.querySelectorAll('video').forEach((v, i) => {
                console.log(`Video ${i} position:`, v.getBoundingClientRect());
            });
        }, 2000);
    </script>
</body>
</html>